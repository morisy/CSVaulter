document.addEventListener('DOMContentLoaded', function() {
    console.log('Document loaded. Starting to fetch the CSV...');
    fetch('requests.csv')
        .then(response => {
            console.log('CSV fetched successfully. Converting to text...');
            return response.text();
        })
        .then(data => {
            console.log('CSV text conversion done. Parsing data...');
            const rows = data.split(/\r\n|\n/);
            console.log(`Total rows in CSV (including header): ${rows.length}`);

            const titles = rows.slice(1).map(row => {
                const matches = row.match(/"([^"]+)"/); // Attempt to capture quoted strings
                if (matches) {
                    console.log(`Quoted string found: ${matches[1]}`);
                    return matches[1];
                } else {
                    const splitRow = row.split(',')[1]; // Fallback
                    console.log(`Fallback split used, selected title: ${splitRow}`);
                    return splitRow;
                }
            });

            if (titles.length > 0) {
                const randomIndex = Math.floor(Math.random() * titles.length);
                const selectedTitle = titles[randomIndex];
                console.log(`Selected title: ${selectedTitle}`);

                const titleElement = document.querySelector('h1');
                if (titleElement) {
                    console.log(`Updating H1 element with selected title.`);
                    titleElement.textContent = selectedTitle;
                } else {
                    console.error('H1 element not found.');
                }
            } else {
                console.error('No titles found in CSV.');
            }
        })
        .catch(error => console.error('Error loading the CSV file:', error));
});
